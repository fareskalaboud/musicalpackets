<!DOCTYPE html>
<html>
	<head>
		<link rel="stylesheet" type="text/css" href="main.css">
		<script type="text/javascript" src="jquery-1.11.0.min.js"></script>
		<script type="text/javascript" src="bars.js"></script>
		<script type="text/javascript" src="Chart.js"></script>
		<script type="text/javascript">
			function updateGraphics(data) {
				showDownloadBar(data.packets_per_duration);
                showAverageBar(data.average_packets);
                document.getElementsByClassName("sentPackets")[0].innerHTML = "Total Packets:    " + data.total_packets;
                document.getElementsByClassName("averagePackets")[0].innerHTML = "3 Second Average:    " + data.average_packets;
				fillChart(data.ip_counts);
                updatePacketHtml(data);
			}

            function updatePacketHtml(data) {
                var packetHtml = "<b>Last Packets Recieved:</b><br><br>"
                for (var i = 0; i < data.last_packets.length; i++) {
                    var packet = data.last_packets[i];
                    packetHtml += "Source: " + packet.source_ip + ":" + packet.source_port + " Dest: " + packet.destination_ip + ":" + packet.destination_port + "<br>";
                }
                document.getElementById("listOfPackets").innerHTML = packetHtml
             }

			function requestAjax() {
				var req = new XMLHttpRequest();
				req.open("GET", "http://localhost:9011/ajax", true);
				req.onreadystatechange = function() {
					if (req.readyState != 4 || req.status != 200)
						return;
					updateGraphics(JSON.parse(req.response));
				};
				req.send();
			}


			window.onload = function() {
				setInterval(requestAjax, 500);
			};

			function fillChart(values) {
				var colours = ["#F7464A", "#1A7CE8", "#1EE881", "#949FB1", "#FFD13D"];
				var ipChartData = new Array();
				for (var i = 0; i < values.length; i++) {
					ipChartData[i] = {
						value : values[i].count,
						color : colours[i]
					};
				}
				$("#rechart").html("<canvas id=\"canvas\" height=\"200\" width=\"377\"></canvas>");
				var ipChart = new Chart(document.getElementById("canvas").getContext("2d")).Doughnut(ipChartData, {
					animation : false
				});

			};
		</script>
		<style>
			canvas {
			}
		</style>
	</head>
	<body>

		<div class = "topRow">
			<div class="placeholderLeft">
				<div class="barGraph">
					<table>
						<tbody>
							<tr>
								<td class="barCell">
								<div id="bar_x0_y7">
									<img src="images/seablue_bar_spaced.png"/>
								</div></td>
								<td class="barCell">
								<div id="bar_x1_y7"><img src="images/seablue_bar_spaced.png"/>
								</div></td>

								<td class="barCell">
								<div id="bar_x2_y7"><img src="images/empty_bar_spaced.png"/>
								</div></td>

								<td class="barCell">
								<div id="bar_x3_y7"><img src="images/navyblue_bar_spaced.png"/>
								</div></td>

								<td class="barCell">
								<div id="bar_x4_y7"><img src="images/navyblue_bar_spaced.png"/>
								</div></td>

							</tr>
							<tr>

								<td class="barCell">
								<div id="bar_x0_y6"><img src="images/seablue_bar_spaced.png"/>
								</div></td>

								<td class="barCell">
								<div id="bar_x1_y6"><img src="images/seablue_bar_spaced.png"/>
								</div></td>

								<td class="barCell">
								<div id="bar_x2_y6"><img src="images/empty_bar_spaced.png"/>
								</div></td>

								<td class="barCell">
								<div id="bar_x3_y6"><img src="images/navyblue_bar_spaced.png"/>
								</div></td>

								<td class="barCell">
								<div id="bar_x4_y6"><img src="images/navyblue_bar_spaced.png"/>
								</div></td>

							</tr>
							<tr>

								<td class="barCell">
								<div id="bar_x0_y5"><img src="images/seablue_bar_spaced.png"/>
								</div></td>

								<td class="barCell">
								<div id="bar_x1_y5"><img src="images/seablue_bar_spaced.png"/>
								</div></td>

								<td class="barCell">
								<div id="bar_x2_y5"><img src="images/empty_bar_spaced.png"/>
								</div></td>

								<td class="barCell">
								<div id="bar_x3_y5"><img src="images/navyblue_bar_spaced.png"/>
								</div></td>

								<td class="barCell">
								<div id="bar_x4_y5"><img src="images/navyblue_bar_spaced.png"/>
								</div></td>

							</tr>
							<tr>

								<td class="barCell">
								<div id="bar_x0_y4"><img src="images/seablue_bar_spaced.png"/>
								</div></td>

								<td class="barCell">
								<div id="bar_x1_y4"><img src="images/seablue_bar_spaced.png"/>
								</div></td>

								<td class="barCell">
								<div id="bar_x2_y4"><img src="images/empty_bar_spaced.png"/>
								</div></td>

								<td class="barCell">
								<div id="bar_x3_y4"><img src="images/navyblue_bar_spaced.png"/>
								</div></td>

								<td class="barCell">
								<div id="bar_x4_y4"><img src="images/navyblue_bar_spaced.png"/>
								</div></td>

							</tr>
							<tr>

								<td class="barCell">
								<div id="bar_x0_y3"><img src="images/seablue_bar_spaced.png"/>
								</div></td>

								<td class="barCell">
								<div id="bar_x1_y3"><img src="images/seablue_bar_spaced.png"/>
								</div></td>

								<td class="barCell">
								<div id="bar_x2_y3"><img src="images/empty_bar_spaced.png"/>
								</div></td>

								<td class="barCell">
								<div id="bar_x3_y3"><img src="images/navyblue_bar_spaced.png"/>
								</div></td>

								<td class="barCell">
								<div id="bar_x4_y3"><img src="images/navyblue_bar_spaced.png"/>
								</div></td>

							</tr>
							<tr>

								<td class="barCell">
								<div id="bar_x0_y2"><img src="images/seablue_bar_spaced.png"/>
								</div></td>

								<td class="barCell">
								<div id="bar_x1_y2"><img src="images/seablue_bar_spaced.png"/>
								</div></td>

								<td class="barCell">
								<div id="bar_x2_y2"><img src="images/empty_bar_spaced.png"/>
								</div></td>

								<td class="barCell">
								<div id="bar_x3_y2"><img src="images/navyblue_bar_spaced.png"/>
								</div></td>

								<td class="barCell">
								<div id="bar_x4_y2"><img src="images/navyblue_bar_spaced.png"/>
								</div></td>

							</tr>
							<tr>

								<td class="barCell">
								<div id="bar_x0_y1"><img src="images/seablue_bar_spaced.png"/>
								</div></td>

								<td class="barCell">
								<div id="bar_x1_y1"><img src="images/seablue_bar_spaced.png"/>
								</div></td>

								<td class="barCell">
								<div id="bar_x2_y1"><img src="images/empty_bar_spaced.png"/>
								</div></td>

								<td class="barCell">
								<div id="bar_x3_y1"><img src="images/navyblue_bar_spaced.png"/>
								</div></td>

								<td class="barCell">
								<div id="bar_x4_y1"><img src="images/navyblue_bar_spaced.png"/>
								</div></td>

							</tr>
							<tr>

								<td class="barCell">
								<div id="bar_x0_y0"><img src="images/seablue_bar_spaced.png"/>
								</div></td>

								<td class="barCell">
								<div id="bar_x1_y0"><img src="images/seablue_bar_spaced.png"/>
								</div></td>

								<td class="barCell">
								<div id="bar_x2_y0"><img src="images/empty_bar_spaced.png"/>
								</div></td>

								<td class="barCell">
								<div id="bar_x3_y0"><img src="images/navyblue_bar_spaced.png"/>
								</div></td>

								<td class="barCell">
								<div id="bar_x4_y0"><img src="images/navyblue_bar_spaced.png"/>
								</div></td>

							</tr>
						</tbody>
					</table>
				</div>
			</div>
			<div class="empty">
				<img src="images/empty.png" />
			</div>

			<div class="placeholderRight">
				<div class="chart" id="rechart">
					<canvas id="canvas" height="200" width="377"></canvas>
				</div>
			</div>
		</div>

		<div class="separator"></div>

		<div class="widePlaceholder">
			<div class="packetNumbers">
				<p>
					Number of Packets:
				</p>
				<p>
					<span class = "sentPackets"></span>
					<br/>
					<span class = "averagePackets"></span>
				</p>
			</div>
			<div class="packetListTitle">
				<br/>
				<p id="listOfPackets" class="listOfPackets"></p>				
			</div>
		</div>
	</body>
</html>
